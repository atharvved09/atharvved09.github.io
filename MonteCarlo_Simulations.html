<!DOCTYPE html>
<html>
<head>
    <title>Genetic Drift Lab</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; gap: 20px; max-width: 1200px; }
        canvas { background: #000; border: 1px solid #444; border-radius: 4px; }
        .panel { background: #1e1e1e; padding: 20px; border-radius: 8px; width: 300px; border: 1px solid #333; }
        .stats { margin-top: 20px; font-family: monospace; font-size: 1.2em; color: #00ff00; }
        .summary { margin-top: 20px; padding: 15px; background: #2c3e50; border-radius: 6px; font-size: 0.9em; line-height: 1.4; color: #fff; border-left: 4px solid #3498db; }
        input { width: 100%; margin-bottom: 15px; background: #333; border: 1px solid #555; color: white; padding: 5px; }
        button { width: 100%; padding: 10px; margin-bottom: 5px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .run-btn { background: #27ae60; color: white; }
        .clear-btn { background: #c0392b; color: white; }
        label { font-size: 0.8em; color: #aaa; text-transform: uppercase; }
    </style>
</head>
<body>

    <h2>Evolutionary "Random Walk" Experiment</h2>

    <div class="container">
        <div class="panel">
            <label>Population Size</label>
            <input type="number" id="popInput" value="40">
            
            <label>Number of Runs</label>
            <input type="number" id="simInput" value="50">
            
            <button class="run-btn" onclick="runBatch()">Start Experiment</button>
            <button class="clear-btn" onclick="clearAll()">Clear Canvas</button>

            <div class="stats">
                üìà Fixed: <span id="fixedCount">0</span><br>
                üìâ Extinct: <span id="lostCount">0</span><br>
                ‚è≥ Active: <span id="activeCount">0</span>
            </div>

            <div id="summaryBox" class="summary">
                Ready to simulate... Set a small population (e.g., 10) to see rapid genetic loss.
            </div>
        </div>

        <canvas id="driftCanvas" width="800" height="500"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('driftCanvas');
        const ctx = canvas.getContext('2d');
        let fixed = 0;
        let lost = 0;
        let active = 0;
        let totalSimsRequested = 0;

        function clearAll() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            fixed = 0; lost = 0; active = 0;
            updateDisplay();
            drawGrid();
            document.getElementById('summaryBox').innerHTML = "Canvas cleared. Ready for next trial.";
        }

        function updateDisplay() {
            document.getElementById('fixedCount').innerText = fixed;
            document.getElementById('lostCount').innerText = lost;
            document.getElementById('activeCount').innerText = active;
        }

        function drawGrid() {
            ctx.strokeStyle = "#222";
            for(let i=0; i<=10; i++) {
                let y = i * (canvas.height/10);
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }
        }

        function runBatch() {
            const num = parseInt(document.getElementById('simInput').value);
            const pop = parseInt(document.getElementById('popInput').value);
            totalSimsRequested = num;
            for(let i=0; i<num; i++) {
                active++;
                simulate(pop);
            }
            updateDisplay();
        }

        function simulate(popSize) {
            let freq = 0.5;
            let x = 0;
            let y = canvas.height / 2;
            const color = `hsl(${Math.random() * 360}, 70%, 60%)`;

            function step() {
                let prevX = x;
                let prevY = y;
                x += 4;

                let success = 0;
                for(let i=0; i<popSize; i++) {
                    if(Math.random() < freq) success++;
                }
                freq = success / popSize;
                y = canvas.height - (freq * canvas.height);

                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.globalAlpha = 0.3;
                ctx.moveTo(prevX, prevY);
                ctx.lineTo(x, y);
                ctx.stroke();

                if (freq <= 0) { lost++; active--; finishCheck(); return; }
                if (freq >= 1) { fixed++; active--; finishCheck(); return; }
                if (x > canvas.width) { active--; finishCheck(); return; }

                requestAnimationFrame(step);
                updateDisplay();
            }
            step();
        }

        function finishCheck() {
            if (active === 0) {
                const pop = document.getElementById('popInput').value;
                let msg = "";
                if (pop < 20) {
                    msg = "<b>Result: High Drift.</b> In small populations, random walks hit the boundaries quickly. Luck dominates survival, leading to rapid loss of biodiversity.";
                } else {
                    msg = "<b>Result: Genetic Stability.</b> Larger populations resist the random walk. The gene frequency stays closer to 50%, preserving variety for longer.";
                }
                document.getElementById('summaryBox').innerHTML = msg;
            }
            updateDisplay();
        }

        drawGrid();
    </script>
</body>
</html>

